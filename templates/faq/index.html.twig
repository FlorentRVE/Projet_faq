{% extends 'base.html.twig' %}

{% block title %}FAQ numéro client{% endblock %}

{% block body %}

    <div>

        {# ==================================================== | Page principale FAQ | =================================================#}

        <header class="bg-sky-900 dark:bg-slate-900 p-2">
        
            {# =========== Titre et bouton de connexion/acces panneau de configuration et dark mode ============= #}
            <div class="flex">

                <div class="toggleDark flex flex-col p-4 text-center transition-all hover:scale-105 cursor-pointer">
                    <i class="fa-solid fa-circle-half-stroke text-slate-50 text-2xl text-center px-4 py-1 font-semibold"></i>
                </div>

                <h1 class="text-center text-3xl uppercase text-slate-100 font-bold flex-auto ml-24">FAQ numéro client</h1>
                
                {% if is_granted('ROLE_USER') %}
                    <a href="{{ path('app_question_index') }}"  class="flex flex-col p-4 text-center transition-all hover:scale-105">
                        <p class="font-semibold text-slate-100">Panneau d'administration</p>
                        <i class="fa-solid fa-gears text-slate-50 text-2xl text-center px-4 py-1 font-semibold"></i>
                    </a>
                {% else %}
                    <a href="{{ path('app_login') }}"  class="flex flex-col p-4 text-center transition-all hover:scale-105">
                        <p class="font-semibold text-slate-100">Connexion</p>
                        <i class="fa-solid fa-user text-slate-50 text-2xl text-center px-4 py-1 font-semibold"></i>
                    </a>
                {% endif %}
            </div>

            {# ======================= Barre de recherche ======================#}
            <form action="#" method="get" class="p-4 shadow-lg text-lg text-center">
                <label for="search" class="text-slate-100 font-semibold">Rechercher </label>
                <input type="text" id="search" name="search" value="{{ searchTerm }}" class="w-1/2 text-slate-900 px-2 rounded-lg" placeholder="Rechercher dans les questions ou réponses ...">
                <button type="submit" class="text-center px-4 py-1 hover:brightness-125 text-slate-50 text-2xl transition-all hover:scale-110"><i class="fa-solid fa-magnifying-glass"></i></button>
            </form>

        </header>

        {# =========================== Sidebar ========================= #}
        <sidebar>
            <div class="absolute left-0 top-33 h-screen border-r border-slate-300 dark:border-slate-600">
                <div class="flex flex-col items-center w-48">


                    {# ==================== Boutons de tri par département ==============#}
                    {# Récupère les départements des questions pour créer les boutons de tri correspondant #}
                    <div class="flex flex-col gap-5 justify-evenly p-3 rounded-2xl uppercase w-full">

                        <a href="{{ path('app_faq') }}" class="reset text-sky-900 dark:text-sky-600 text-center py-2 font-bold cursor-pointer text-xl">Tous</a>

                        {# === Pour chaque département dans le tableau on crée un bouton de tri correspondant === #}
                        {% for departement in data %}
                            <p data-departement="{{ departement }}" class="departement text-sky-900 dark:text-sky-600 text-center py-2  font-bold cursor-pointer text-xl">{{ departement }}</p>
                        {% endfor %} 

                        {% if is_granted('ROLE_USER') %}
                            {# <a href="{{ path('app_saisi_new') }}" class="text-sky-900 dark:text-sky-600 text-center py-2 font-bold cursor-pointer text-xl mt-10">Saisir demande</a> #}
                            <button class="btn btn-primary text-sky-900 dark:text-sky-600 text-center py-2 font-bold cursor-pointer text-xl mt-10" onclick="my_modal_1.showModal()">Saisir demande</button>
                            <a href="{{ path('app_saisi_index') }}" class="text-sky-900 dark:text-sky-600 text-center py-2 font-bold cursor-pointer text-xl">Liste saisi</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </sidebar>

        <content>

            {# ========== Affichage des questions regroupées par departement puis catégorie =========#}
            <div class="flex flex-wrap gap-10 ml-44 mt-9">

                {% if data is not empty %}

                    {% for departement in data %}

                        <div class="container p-4 flex flex-col gap-10 mx-auto">

                            <div class="flex">
                                <div class="h-auto w-3 bg-green-500 mr-2"></div>
                                <h2 class="uppercase p-2 font-black text-slate-900 dark:text-slate-300 rounded-xl text-4xl font">{{ departement }}</h2>
                            </div>

                                <div class="flex flex-row flex-wrap gap-10 justify-between">

                                    {% for categorie in departement.categories %} 

                                        <div class="container flex flex-col w-[47%] border-r-2 border-slate-300 dark:border-slate-600 p-2">
                                            <h3 class="p-2 font-extrabold text-slate-900 dark:text-slate-300 mb-1 text-2xl">{{ categorie }}</h3>

                                            {% for question in categorie.questions %}
                                                <div class="toggleBtn objet mb-1 cursor-pointer" data-departement="{{ departement }}">
                                                    <h3 class=" text-sky-800 dark:text-sky-600 font-semibold p-2 hover:underline">{{ question.label }}</h3>
                                                    <div class="answer bg-slate-50 dark:text-slate-300 dark:bg-slate-800">{{ question.reponse | raw }}</div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% endfor %}
                                </div>
                        </div>
                    {% endfor %}
                    
                {% else %}

                    <div class="bg-yellow-100 rounded-xl p-11 mx-auto">
                        <p class="text-red-500 text-3xl">Aucune question ne correspond à votre recherche...</p>
                    </div>
                {% endif %}
            </div>
        </content>

        <div>
            <button class="topBtn fixed bottom-[4%] right-[4%] bg-sky-800 dark:bg-sky-900 text-slate-100 px-3 py-2 rounded-full font-semibold">Haut de page</button>
        </div>

        {# ======= MODAL FORM ========= #}
        {% if is_granted('ROLE_USER') %}
        <dialog id="my_modal_1" class="modal rounded-xl">
            <div class="modal-box">
                <div class="modal-action flex flex-col">
                    <h1 class="text-center text-3xl uppercase text-slate-100 font-bold bg-slate-800 py-5 shadow-xl">Nouvelle saisi</h1>

                    <div class="bg-slate-800 p-4 mx-auto mb-6  shadow-xl w-full">
                        {{ form_errors(form) }}

                        {{ form_start(form) }}
                            <div class="w-11/12 mx-auto flex flex-col">

                                <div class="mb-8 flex flex-col">
                                    {{ form_label(form.nom, 'Nom', {'label_attr': {'class': 'text-slate-100 uppercase font-semibold mb-2'}}) }}
                                    {{ form_widget(form.nom, {'attr': {'class': 'p-2 rounded-lg'}}) }}
                                </div>

                                <div class="mb-8 flex flex-col">
                                    {{ form_label(form.prenom, 'Prénom', {'label_attr': {'class': 'text-slate-100 uppercase font-semibold mb-2'}}) }}
                                    {{ form_widget(form.prenom, {'attr': {'class': 'p-2 rounded-lg'}}) }}
                                </div>

                                <div class="mb-8 flex flex-col">
                                    {{ form_label(form.telephone, 'Téléphone', {'label_attr': {'class': 'text-slate-100 uppercase font-semibold mb-2'}}) }}
                                    {{ form_widget(form.telephone, {'attr': {'class': 'rounded-lg font-semibold uppercase p-2'}}) }}
                                </div>

                                <div class="mb-8 flex flex-col">
                                    {{ form_label(form.commentaire, 'Commentaire', {'label_attr': {'class': 'text-slate-100 uppercase font-semibold mb-2'}}) }}
                                    {{ form_widget(form.commentaire, {'attr': {'class': 'rounded-lg font-semibold uppercase p-2'}}) }}
                                </div>

                                <div class="mb-8 flex flex-col">
                                    {{ form_label(form.typeDemande, 'Type de demande', {'label_attr': {'class': 'text-slate-100 uppercase font-semibold mb-2'}}) }}
                                    {{ form_widget(form.typeDemande, {'attr': {'class': 'rounded-lg font-semibold uppercase p-2'}}) }}
                                </div>

                                <div class="mb-8 flex flex-col">
                                    {{ form_label(form.motif, 'Motif', {'label_attr': {'class': 'text-slate-100 uppercase font-semibold mb-2'}}) }}
                                    {{ form_widget(form.motif, {'attr': {'class': 'rounded-lg font-semibold uppercase p-2'}}) }}
                                </div>

                                <button class="btn bg-green-500 rounded-2xl text-center hover:brightness-125 shadow-lg font-bold px-7 py-3 w-full text-lg">{{ button_label|default('Créer la saisi') }}</button>
                            </div>
                        {{ form_end(form) }}
                    </div>
                    <div class="flex justify-between w-full mx-auto bg-slate-800">
                        <a href="{{ path('app_faq') }}"  class="bg-sky-800 text-slate-50 rounded-2xl text-center px-5 py-3 hover:brightness-125 shadow-lg w-full font-semibold">Retour</a>
                    </div>

                </div>
            </div>
        </dialog>
        {% endif %}

    </div>
{% endblock %}
